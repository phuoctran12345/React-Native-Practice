---
description:
globs:
alwaysApply: true
---
Quy Táº¯c Thiáº¿t Káº¿ MÃ´ HÃ¬nh 3D cho AR (React Native)
TÃ i liá»‡u nÃ y quy Ä‘á»‹nh cÃ¡c yÃªu cáº§u ká»¹ thuáº­t báº¯t buá»™c Ä‘á»‘i vá»›i táº¥t cáº£ cÃ¡c mÃ´ hÃ¬nh 3D (assets) Ä‘Æ°á»£c sá»­ dá»¥ng trong dá»± Ã¡n AR React Native (sá»­ dá»¥ng cÃ¡c thÆ° viá»‡n nhÆ° ViroReact, Three.js, Expo-GL).

1. Hiá»‡u NÄƒng & Tá»‘i Æ¯u HÃ³a (Quan trá»ng nháº¥t)
ÄÃ¢y lÃ  Æ°u tiÃªn hÃ ng Ä‘áº§u. Má»™t model Ä‘áº¹p mÃ  khÃ´ng cháº¡y mÆ°á»£t thÃ¬ cÅ©ng vÃ´ dá»¥ng.

Polycount (Sá»‘ LÆ°á»£ng Polygon):

Quy táº¯c chung: LuÃ´n giá»¯ á»Ÿ má»©c tháº¥p nháº¥t cÃ³ thá»ƒ mÃ  váº«n Ä‘áº£m báº£o Ä‘Æ°á»£c hÃ¬nh dÃ¡ng (silhouette) cá»§a váº­t thá»ƒ.

Äá»‘i tÆ°á»£ng chÃ­nh (Hero Asset): Cá»‘ gáº¯ng giá»¯ dÆ°á»›i 50,000 polygons (tris).

Äá»‘i tÆ°á»£ng phá»¥/cáº£nh (Prop/Scenery): DÆ°á»›i 10,000 polygons.

ToÃ n cáº£nh (Total Scene): Tá»•ng sá»‘ polygon hiá»ƒn thá»‹ cÃ¹ng lÃºc khÃ´ng nÃªn vÆ°á»£t quÃ¡ 200,000 polygons Ä‘á»ƒ Ä‘áº£m báº£o tÆ°Æ¡ng thÃ­ch vá»›i cÃ¡c thiáº¿t bá»‹ táº§m trung.

Draw Calls (Lá»‡nh Gá»i Váº½):

ÄÃ¢y lÃ  "káº» thÃ¹" lá»›n nháº¥t cá»§a hiá»‡u nÄƒng. Má»—i váº­t liá»‡u (material) riÃªng biá»‡t trÃªn má»—i Ä‘á»‘i tÆ°á»£ng (mesh) lÃ  má»™t draw call.

Gá»™p Mesh (Combine Meshes): Gá»™p táº¥t cáº£ cÃ¡c pháº§n tÄ©nh (static parts) cá»§a má»™t model thÃ nh má»™t mesh duy nháº¥t. VÃ­ dá»¥: má»™t chiáº¿c xe nÃªn lÃ  1 mesh, khÃ´ng pháº£i lÃ  4 bÃ¡nh xe, 1 thÃ¢n xe, 2 Ä‘Ã¨n... riÃªng láº».

Gá»™p Váº­t Liá»‡u (Texture Atlas): Sá»­ dá»¥ng 1 texture duy nháº¥t (gá»i lÃ  Texture Atlas) cho nhiá»u Ä‘á»‘i tÆ°á»£ng hoáº·c nhiá»u pháº§n cá»§a 1 Ä‘á»‘i tÆ°á»£ng. LÃ½ tÆ°á»Ÿng nháº¥t, má»—i model chá»‰ nÃªn cÃ³ 1 váº­t liá»‡u (1 material).

KÃ­ch ThÆ°á»›c File:

File .glb cuá»‘i cÃ¹ng nÃªn cÃ³ dung lÆ°á»£ng < 5MB.

Sá»­ dá»¥ng nÃ©n Draco (má»™t tÃ¹y chá»n khi export tá»« Blender) Ä‘á»ƒ giáº£m kÃ­ch thÆ°á»›c file mÃ  khÃ´ng áº£nh hÆ°á»Ÿng nhiá»u Ä‘áº¿n cháº¥t lÆ°á»£ng.

2. Äá»‹nh Dáº¡ng File & TÆ°Æ¡ng ThÃ­ch
Äá»‹nh Dáº¡ng Báº¯t Buá»™c: gLTF 2.0

Táº¥t cáº£ model pháº£i Ä‘Æ°á»£c export dÆ°á»›i dáº¡ng .glb (file nhá»‹ phÃ¢n chá»©a cáº£ model vÃ  texture) hoáº·c .gltf (file JSON + file texture riÃªng).

Æ¯u tiÃªn .glb vÃ¬ nÃ³ lÃ  má»™t file duy nháº¥t, dá»… quáº£n lÃ½ vÃ  load nhanh hÆ¡n.

Váº­t Liá»‡u (Materials):

Pháº£i sá»­ dá»¥ng váº­t liá»‡u PBR (Physically Based Rendering).

CÃ¡c map PBR tiÃªu chuáº©n Ä‘Æ°á»£c há»— trá»£: Base Color (Albedo), Metallic, Roughness, Normal, Ambient Occlusion (AO), Emissive.

TÆ°Æ¡ng ThÃ­ch:

KhÃ´ng sá»­ dá»¥ng cÃ¡c shader (cháº¥t liá»‡u) Ä‘áº·c biá»‡t, phá»©c táº¡p hoáº·c cÃ¡c tÃ­nh nÄƒng Ä‘á»™c quyá»n cá»§a pháº§n má»m 3D (nhÆ° Arnold, V-Ray). Chá»‰ dÃ¹ng cÃ¡c node PBR tiÃªu chuáº©n cá»§a gLTF.

3. Textures (Há»a Tiáº¿t)
KÃ­ch ThÆ°á»›c (Dimensions):

Pháº£i lÃ  lÅ©y thá»«a cá»§a 2 (Powers of Two - POT). VÃ­ dá»¥: 512x512, 1024x1024, 2048x2048.

Tuyá»‡t Ä‘á»‘i khÃ´ng dÃ¹ng kÃ­ch thÆ°á»›c láº» (vÃ­ dá»¥: 1200x800).

Giá»›i háº¡n: Tá»‘i Ä‘a lÃ  2048x2048 (2K) cho Ä‘á»‘i tÆ°á»£ng chÃ­nh. Æ¯u tiÃªn 1024x1024 (1K) cho háº§u háº¿t cÃ¡c model.

Äá»‹nh Dáº¡ng (Format):

Sá»­ dá»¥ng .jpg cho cÃ¡c texture khÃ´ng cáº§n kÃªnh alpha (nhÆ° Base Color, Normal).

Sá»­ dá»¥ng .png cho cÃ¡c texture cáº§n kÃªnh alpha (trong suá»‘t).

Tá»‘i Æ¯u Map (Channel Packing):

ÄÃ¢y lÃ  má»™t ká»¹ thuáº­t tá»‘i Æ°u cao cáº¥p: Gá»™p 3 map tráº¯ng Ä‘en (Metallic, Roughness, Ambient Occlusion) vÃ o 3 kÃªnh R, G, B cá»§a má»™t file texture duy nháº¥t (thÆ°á»ng gá»i lÃ  map ORM).

Viá»‡c nÃ y giáº£m sá»‘ lÆ°á»£ng file texture cáº§n load tá»« 3 xuá»‘ng cÃ²n 1.

4. TiÃªu Chuáº©n Cho AR (Ráº¥t Quan Trá»ng)
Tá»· Lá»‡ (Scale):

Model pháº£i Ä‘Æ°á»£c lÃ m á»Ÿ tá»· lá»‡ 1:1 vá»›i tháº¿ giá»›i thá»±c.

Quy táº¯c: 1 Ä‘Æ¡n vá»‹ (unit) trong pháº§n má»m 3D (Blender, Maya...) = 1 mÃ©t ngoÃ i Ä‘á»i thá»±c.

VÃ­ dá»¥: Náº¿u lÃ m cÃ¡i bÃ n cao 0.8m, thÃ¬ model trong Blender pháº£i cao 0.8 units.

TÃ¢m Xoay (Pivot Point / Origin):

TÃ¢m cá»§a model pháº£i Ä‘Æ°á»£c Ä‘áº·t á»Ÿ dÆ°á»›i Ä‘Ã¡y, chÃ­nh giá»¯a (0, 0, 0) cá»§a váº­t thá»ƒ.

Äiá»u nÃ y quyáº¿t Ä‘á»‹nh model sáº½ "Ä‘Ã¡p" xuá»‘ng máº·t pháº³ng (plane) trong AR nhÆ° tháº¿ nÃ o. Náº¿u Ä‘áº·t sai, model sáº½ lÆ¡ lá»­ng hoáº·c "chÃ¬m" xuá»‘ng Ä‘áº¥t.

Transforms:

TrÆ°á»›c khi export, pháº£i "Ä‘Ã³ng bÄƒng" (Freeze Transformations / Apply Transformations) táº¥t cáº£ cÃ¡c thay Ä‘á»•i vá» vá»‹ trÃ­, xoay, vÃ  tá»· lá»‡.

Trong Blender: Chá»n model, nháº¥n Ctrl + A -> All Transforms.

Model cuá»‘i cÃ¹ng pháº£i cÃ³ Vá»‹ trÃ­ (Location) = (0,0,0), Xoay (Rotation) = (0,0,0), vÃ  Tá»· lá»‡ (Scale) = (1,1,1).

HÆ°á»›ng (Orientation):

Model pháº£i hÆ°á»›ng vá» phÃ­a trÆ°á»›c theo trá»¥c -Z (hoáº·c +Z, tÃ¹y quy Æ°á»›c cá»§a thÆ° viá»‡n, nhÆ°ng pháº£i nháº¥t quÃ¡n). Trá»¥c +Y pháº£i lÃ  trá»¥c "lÃªn" (Up).

5. Cáº¥u TrÃºc & Äáº·t TÃªn
Dá»n Dáº¹p Scene:

XÃ³a táº¥t cáº£ camera, Ä‘Ã¨n (lights), vÃ  cÃ¡c node rÃ¡c khÃ´ng cáº§n thiáº¿t ra khá»i file export.

Äáº·t TÃªn:

Táº¥t cáº£ mesh, váº­t liá»‡u, vÃ  texture pháº£i Ä‘Æ°á»£c Ä‘áº·t tÃªn rÃµ rÃ ng, báº±ng tiáº¿ng Anh khÃ´ng dáº¥u, khÃ´ng kÃ½ tá»± Ä‘áº·c biá»‡t.

Tá»‘t: Pikachu_Mesh, Pikachu_Material

Xáº¥u: Cube.001, Material_v2_final

TÃ³m Táº¯t (Checklist Nhanh)
TrÆ°á»›c khi gá»­i model cho láº­p trÃ¬nh viÃªn (hoáº·c tá»± sá»­ dá»¥ng):

[ ] Äá»‹nh dáº¡ng: LÃ  file .glb chÆ°a?

[ ] Váº­t liá»‡u: ÄÃ£ dÃ¹ng PBR chuáº©n chÆ°a?

[ ] Tá»· lá»‡: ÄÃ£ Ä‘Ãºng 1 unit = 1 mÃ©t chÆ°a?

[ ] TÃ¢m (Pivot): ÄÃ£ á»Ÿ dÆ°á»›i Ä‘Ã¡y, chÃ­nh giá»¯a chÆ°a?

[ ] Transform: ÄÃ£ "Apply All Transforms" chÆ°a (Scale = 1, 1, 1)?

[ ] Polycount: CÃ³ dÆ°á»›i 50,000 tris khÃ´ng?

[ ] Draw Calls: ÄÃ£ gá»™p thÃ nh 1 mesh, 1 váº­t liá»‡u chÆ°a?

[ ] Texture: KÃ­ch thÆ°á»›c cÃ³ pháº£i lÃ  lÅ©y thá»«a cá»§a 2 (POT) vÃ  dÆ°á»›i 2K khÃ´ng?


. Kiáº¿n TrÃºc Code & TÃ­nh Má»Ÿ Rá»™ng (Scalability)
KhÃ´ng Hardcode TÃªn File: ÄÃ¢y lÃ  quy táº¯c vÃ ng Ä‘á»ƒ má»Ÿ rá»™ng.

Tá»‡ (Hardcode): const model = require('./assets/pikachu.glb');

Tá»‘t (Scalable): Táº¡o má»™t component ARViewer cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng, nháº­n model nhÆ° má»™t prop.



. Há»— Trá»£ CÃ¡c Chá»©c NÄƒng 3D Cá»‘t LÃµi
Component 3D/AR cá»§a báº¡n pháº£i Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ xá»­ lÃ½ cÃ¡c chá»©c nÄƒng cÆ¡ báº£n mÃ  file .glb cung cáº¥p, thay vÃ¬ chá»‰ hiá»ƒn thá»‹ tÄ©nh.

Há»— trá»£ Animation (Quan trá»ng):

Äá»‹nh dáº¡ng .glb cÃ³ thá»ƒ chá»©a nhiá»u "track" animation (vÃ­ dá»¥: "Idle", "Walk", "Attack").

Code cá»§a báº¡n pháº£i cÃ³ kháº£ nÄƒng Ä‘á»c danh sÃ¡ch cÃ¡c animation cÃ³ trong file vÃ  kÃ­ch hoáº¡t (play/stop/loop) má»™t animation cá»¥ thá»ƒ dá»±a theo logic (vÃ­ dá»¥: khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt).

TÆ°Æ¡ng TÃ¡c Xoay/Zoom (360 View):

Cung cáº¥p kháº£ nÄƒng cho ngÆ°á»i dÃ¹ng tÆ°Æ¡ng tÃ¡c vá»›i model (ngay cáº£ khi khÃ´ng á»Ÿ cháº¿ Ä‘á»™ AR).

Sá»­ dá»¥ng cÃ¡c thÆ° viá»‡n cá»­ chá»‰ (vÃ­ dá»¥: react-native-gesture-handler) Ä‘á»ƒ cho phÃ©p ngÆ°á»i dÃ¹ng dÃ¹ng 1 ngÃ³n tay xoay 360 Ä‘á»™ (orbit) hoáº·c dÃ¹ng 2 ngÃ³n tay Ä‘á»ƒ zoom (pinch-to-zoom) model.


Okay, dá»±a trÃªn file JSON báº¡n cung cáº¥p vÃ  cÃ¡c log lá»—i, Ä‘Ã¢y lÃ  "cÃ´ng thá»©c" (hay quy trÃ¬nh) mÃ  má»™t trÃ¬nh render (nhÆ° three.js hoáº·c expo-three) sá»­ dá»¥ng Ä‘á»ƒ láº¥y mÃ u tá»« texture vÃ  Ã¡p lÃªn mÃ´ hÃ¬nh con cÃ¡o:

XÃ¡c Ä‘á»‹nh Mesh vÃ  Váº­t liá»‡u:

TrÃ¬nh render tÃ¬m Ä‘áº¿n máº£ng meshes. á» Ä‘Ã¢y cÃ³ má»™t mesh tÃªn "fox1" (index 0).

Mesh nÃ y sá»­ dá»¥ng váº­t liá»‡u (material) cÃ³ index 0 ( "material": 0).

TÃ¬m thÃ´ng tin Texture trong Váº­t liá»‡u:

TrÃ¬nh render vÃ o máº£ng materials, tÃ¬m váº­t liá»‡u á»Ÿ index 0 ("fox_material").

Trong "pbrMetallicRoughness", nÃ³ tháº¥y "baseColorTexture": { "index": 0 }. Äiá»u nÃ y nÃ³i ráº±ng mÃ u cÆ¡ báº£n cá»§a váº­t liá»‡u nÃ y Ä‘Æ°á»£c láº¥y tá»« texture cÃ³ index 0.

TÃ¬m Texture vÃ  Nguá»“n áº£nh:

TrÃ¬nh render vÃ o máº£ng textures, tÃ¬m texture á»Ÿ index 0.

Texture nÃ y cÃ³ "source": 0, nghÄ©a lÃ  nÃ³ sá»­ dá»¥ng hÃ¬nh áº£nh (image) cÃ³ index 0.

XÃ¡c Ä‘á»‹nh vá»‹ trÃ­ dá»¯ liá»‡u áº£nh:

TrÃ¬nh render vÃ o máº£ng images, tÃ¬m image á»Ÿ index 0.

Image nÃ y cÃ³ "mimeType": "image/png" vÃ  "bufferView": 7. Äiá»u nÃ y cá»±c ká»³ quan trá»ng: nÃ³ cho biáº¿t Ä‘Ã¢y lÃ  áº£nh PNG vÃ  dá»¯ liá»‡u thá»±c táº¿ cá»§a áº£nh náº±m trong bufferView thá»© 7.

Truy cáº­p dá»¯ liá»‡u áº£nh trong khá»‘i BIN:

TrÃ¬nh render vÃ o máº£ng bufferViews, tÃ¬m bufferView á»Ÿ index 7.

bufferView 7 cÃ³ "buffer": 0, "byteOffset": 119904, "byteLength": 26764. Äiá»u nÃ y hÆ°á»›ng dáº«n trÃ¬nh render: "HÃ£y vÃ o khá»‘i dá»¯ liá»‡u nhá»‹ phÃ¢n (buffer 0 - chÃ­nh lÃ  khá»‘i BIN), nháº£y Ä‘áº¿n vá»‹ trÃ­ byte thá»© 119904, vÃ  Ä‘á»c 26764 bytes tiáº¿p theo. ÄÃ³ chÃ­nh lÃ  dá»¯ liá»‡u cá»§a file áº£nh PNG."

Giáº£i mÃ£ áº£nh vÃ  táº¡o Texture:

TrÃ¬nh render láº¥y 26764 bytes dá»¯ liá»‡u PNG Ä‘Ã³ tá»« khá»‘i BIN.

NÃ³ giáº£i mÃ£ dá»¯ liá»‡u PNG nÃ y Ä‘á»ƒ táº¡o thÃ nh má»™t Ä‘á»‘i tÆ°á»£ng Texture (vÃ­ dá»¥: THREE.Texture) mÃ  card Ä‘á»“ há»a cÃ³ thá»ƒ hiá»ƒu.

XÃ¡c Ä‘á»‹nh Tá»a Ä‘á»™ UV:

Quay láº¡i meshes -> primitives -> attributes, trÃ¬nh render tháº¥y "TEXCOORD_0": 1. Äiá»u nÃ y chá»‰ Ä‘á»‹nh ráº±ng tá»a Ä‘á»™ UV (Ä‘á»ƒ biáº¿t cÃ¡ch "dÃ¡n" texture lÃªn bá» máº·t) náº±m trong accessor cÃ³ index 1.

TrÃ¬nh render vÃ o máº£ng accessors, tÃ¬m accessor á»Ÿ index 1. Accessor nÃ y mÃ´ táº£ cÃ¡ch Ä‘á»c dá»¯ liá»‡u tá»a Ä‘á»™ UV (dáº¡ng VEC2 - cáº·p sá»‘ thá»±c) tá»« bufferView 1 trong khá»‘i BIN.

Ãp Texture lÃªn MÃ´ hÃ¬nh (Rendering):

Khi váº½ cÃ¡c tam giÃ¡c (polygons) táº¡o nÃªn con cÃ¡o, trÃ¬nh render sá»­ dá»¥ng tá»a Ä‘á»™ UV Ä‘á»c Ä‘Æ°á»£c tá»« bÆ°á»›c 7 cho má»—i Ä‘á»‰nh cá»§a tam giÃ¡c.

Dá»±a vÃ o tá»a Ä‘á»™ UV, nÃ³ xÃ¡c Ä‘á»‹nh Ä‘iá»ƒm áº£nh (pixel) tÆ°Æ¡ng á»©ng trÃªn Ä‘á»‘i tÆ°á»£ng Texture (Ä‘Ã£ giáº£i mÃ£ tá»« áº£nh PNG á»Ÿ bÆ°á»›c 6).

NÃ³ láº¥y mÃ u cá»§a pixel Ä‘Ã³ trÃªn texture vÃ  tÃ´ mÃ u cho Ä‘iá»ƒm tÆ°Æ¡ng á»©ng trÃªn bá» máº·t 3D cá»§a con cÃ¡o.

TÃ³m láº¡i: JSON chá»‰ lÃ  "báº£n Ä‘á»“" chá»‰ Ä‘Æ°á»ng. NÃ³ nÃ³i cho trÃ¬nh render biáº¿t: "MÃ u cá»§a con cÃ¡o lÃ  má»™t áº£nh PNG, náº±m á»Ÿ vá»‹ trÃ­ X trong khá»‘i dá»¯ liá»‡u nhá»‹ phÃ¢n BIN. HÃ£y dÃ¹ng tá»a Ä‘á»™ UV á»Ÿ vá»‹ trÃ­ Y Ä‘á»ƒ dÃ¡n áº£nh Ä‘Ã³ lÃªn mÃ´ hÃ¬nh."


cuá»‘i cÃ¹ng render hÃ£y cho tÃ´i thÃªm má»™t table analyst láº¡i váº¥n Ä‘á» gÃ¬ cÃ²n vÃ  thiáº¿u nhÃ© 

//===========================================================================
NguyÃªn táº¯c chÃ­nh Ä‘á»ƒ render ra mÃ u (texture) cho model 3D lÃ :

ğŸ—ºï¸ Model cÃ³ UV Map: Má»—i Ä‘iá»ƒm trÃªn model 3D pháº£i biáº¿t vá»‹ trÃ­ tÆ°Æ¡ng á»©ng cá»§a nÃ³ trÃªn má»™t táº¥m áº£nh 2D (gá»i lÃ  tá»a Ä‘á»™ UV). File Fox.glb cá»§a báº¡n Ä‘Ã£ cÃ³ cÃ¡i nÃ y.

ğŸ–¼ï¸ CÃ³ áº¢nh Texture: Pháº£i cÃ³ file áº£nh chá»©a mÃ u sáº¯c (nhÆ° Fox.png). áº¢nh nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c nhÃºng trong file .glb hoáº·c lÃ  file riÃªng.

ğŸ”— Material Káº¿t Ná»‘i: Váº­t liá»‡u (material) cá»§a model pháº£i Ä‘Æ°á»£c cÃ i Ä‘áº·t Ä‘á»ƒ sá»­ dá»¥ng áº£nh texture Ä‘Ã³ lÃ m mÃ u cÆ¡ báº£n (thÆ°á»ng gÃ¡n vÃ o thuá»™c tÃ­nh map).

â³ Dá»¯ Liá»‡u áº¢nh Sáºµn SÃ ng: Quan trá»ng nháº¥t: Dá»¯ liá»‡u pixel cá»§a áº£nh texture pháº£i Ä‘Æ°á»£c táº£i xong hoÃ n toÃ n vÃ  sáºµn sÃ ng trong bá»™ nhá»› trÆ°á»›c khi bá»™ render (WebGLRenderer) cá»‘ gáº¯ng váº½ model báº±ng texture Ä‘Ã³. Lá»—i mÃ u Ä‘en xáº£y ra khi texture Ä‘Æ°á»£c gÃ¡n nhÆ°ng dá»¯ liá»‡u áº£nh bÃªn trong nÃ³ chÆ°a ká»‹p load (lá»—i báº¥t Ä‘á»“ng bá»™).

ğŸ’¡ CÃ³ Ãnh SÃ¡ng: Scene 3D pháº£i cÃ³ Ä‘á»§ Ã¡nh sÃ¡ng (AmbientLight, DirectionalLight). Model sáº½ mÃ u Ä‘en trong bÃ³ng tá»‘i hoÃ n toÃ n, ngay cáº£ khi cÃ³ texture.


khÃ´ng render ra file .md ná»¯a 
chá»‰ render ra table report sau cáº­p nháº­t code thÃ´i nhÃ©